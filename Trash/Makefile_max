#this is the comment
#variables defined as NAME:=  (NAME can be any) and addressed as $(NAME) 
#if you want to recompile all:  "make clean"  then "make all"
#if you want to recompile only complex class without recompilation of all other classes: "make complex.o"  then "make example"

#compilator name (for example could be mpicc instead)
CC:=g++

#LIBRARIES (can also include path to these libraries as -L/SOME_PATH)
LIB:=-lm

#Optimization (-O3 or -O2)
OPT:=-O3


#directory for .o files
OBJECT_DIR:=./object

#directory for executables
BIN_DIR:=./bin

#directory for .cpp files
SRC_DIR1 = ./source
SRC_DIR2 = ./source/Quantum

SRC_FILES = $(wildcard $(SRC_DIR1)/*.cpp)
SRC_FILES += $(wildcard $(SRC_DIR2)/*.cpp)

SRC_FILES_NAMES =  $(notdir$(SRC_FILES))

#directory for .h files
INC_DIR1 =./include
INC_DIR2 =./include/Quantum

#List of source files

OBJ_FILES := $(patsubst %.cpp, $(OBJECT_DIR)/%.o, $(SRC_FILE_NAMES))

OBJ_FILES_NAMES := $(SRC_FILES_NAMES:.cpp=.o)

FILES_NAMES := $(patsubst %.o, %, $(OBJ_FILES_NAMES))

all: example

example:  $(OBJ_FILES_NAMES)
	$(CC)  $(OPT)  $(OBJ_FILES)  -o $(BIN_DIR)/example   $(LIB)

#two equivalent ways: semicolumn of hard-tab (two tabs in mcedit) in the next line

define app_compile_template
 $(1)_NAME = $$(patsubst %.o,%, $(1))
 $(1)_CPP_NAME = $$(SOURCE_DIR)/$$($(1)_NAME).cpp
 $(1)_OBJ_NAME = $$(OBJECT_DIR)/$$($(1)_NAME).o
$(1): $$($(1)_CPP_NAME)
	$$(CC) $$(OPT) -c $$($(1)_CPP_NAME)  -o $$($(1)_OBJ_NAME) -I $$(INCLUDE_DIR)
endef

$(foreach app, $(OBJ_FILES_NAMES), $(eval $(call app_compile_template,$(app))))

#cleaning
clean:
    rm -rf $(OBJECT_DIR)/*.o $(BIN_DIR)/example

list_object_files:
    echo $(OBJ_FILES_NAMES)

